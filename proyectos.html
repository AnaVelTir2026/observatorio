<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Proyectos emblemáticos — Observatorio</title>
  <link rel="stylesheet" href="css/styles.css" />
  <meta name="description" content="Explora proyectos por ubicación, año e instrumento de financiación." />
</head>
<body>
<header class="site-header"><div class="container header-inner"><h1 class="logo">Observatorio para la Equidad Territorial y el Reto Demográfico</h1>
<nav class="nav" aria-label="Navegación principal"><ul>
  <li><a href="index.html">Inicio</a></li>
  <li><a href="que-es.html">¿Qué es?</a></li>
  <li><a href="marco-normativo.html">Marco normativo</a></li>
  <li><a href="rural-proofing.html">Rural Proofing</a></li>
  <li><a href="datos-analisis.html">Datos y análisis</a></li>
  <li><a href="publicaciones.html">Publicaciones</a></li>
  <li><a href="ayudas.html">Ayudas</a></li>
  <li><a class="active" href="proyectos.html">Proyectos</a></li>
  <li><a href="actualidad.html">Actualidad</a></li>
</ul></nav></div></header>
<section class="hero"><div class="container hero-inner"><h2>Proyectos emblemáticos</h2><p class="muted">Filtra por <strong>Ubicación</strong>, <strong>Año</strong> e <strong>Instrumento de financiación</strong>.</p></div></section>
<main id="main">
  <section class="section container">
    <h2>Filtros</h2>
    <div class="grid-3" style="align-items:end">
      <div>
        <label for="f-ubicacion"><strong>Ubicación</strong></label>
        <select id="f-ubicacion" style="width:100%;padding:.6rem;border:1px solid var(--border);border-radius:8px"><option value="">Todas</option></select>
      </div>
      <div>
        <label for="f-anio"><strong>Año</strong></label>
        <select id="f-anio" style="width:100%;padding:.6rem;border:1px solid var(--border);border-radius:8px"><option value="">Todos</option></select>
      </div>
      <div>
        <label for="f-inst"><strong>Instrumento de financiación</strong></label>
        <select id="f-inst" style="width:100%;padding:.6rem;border:1px solid var(--border);border-radius:8px">
          <option value="">Todos</option>
          <option value="bioeconomia">Bioeconomía</option>
          <option value="innovacion">Innovación</option>
          <option value="nominativa">Nominativa</option>
          <option value="red-cit">Red CIT</option>
          <option value="fondo-cohesion">Fondo Cohesión</option>
          <option value="otras">Otras</option>
        </select>
      </div>
      <div><button id="btn-reset" class="btn btn-outline" style="margin-top:1.6rem">Reiniciar filtros</button></div>
    </div>
  </section>

  <section class="section container section-alt">
    <h2>Resultados</h2>
    <div id="cards" class="grid-3"></div>
  </section>
</main>
<footer class="site-footer"><div class="container"><p>© 2026 Observatorio para la Equidad Territorial y el Reto Demográfico</p></div></footer>
<script>
(function(){
  const CARPETA_JSON = 'data/proyectos.json';
  const HAS_FICHA = ["programa-erea", "cuidame", "xarxa-de-punts-nets-avant", "programa-rehabitare", "ayudas-casas-nido"];

  function uniq(arr){ return [...new Set(arr.filter(Boolean))].sort((a,b)=>String(a).localeCompare(String(b),'es',{sensitivity:'base'})); }
  function chip(label, v){ if(!v) return ''; return `<span style="display:inline-block;margin:.15rem .3rem 0 0;padding:.25rem .5rem;border:1px solid var(--border);border-radius:999px;font-size:.8rem;color:var(--muted)">${label}: ${v}</span>`; }
  function esc(s){ return (s||'').replace(/[&<>]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[c])); }
  function card(d){
    const url = (d.enlaces && d.enlaces.length)? d.enlaces[0] : null;
    const hasFicha = HAS_FICHA.includes(d.id);
    const fichaHref = hasFicha ? `proyectos/${d.id}.html` : null;
    return `
    <article class="card" data-ubicacion="${esc(d.ubicacion||'')}" data-inst="${esc(d.instrumento_financiacion||'')}" data-anio="${esc(d.anio||'')}">
      <h3>${esc(d.titulo||'')}</h3>
      <p class="muted" style="margin:.2rem 0 .6rem 0">${esc(d.ubicacion||'')}${d.entidad? ' · '+esc(d.entidad):''}</p>
      <p>${esc(d.resumen||'')}</p>
      <div style="margin-top:.6rem">
        ${chip('Ubicación', esc(d.ubicacion))}
        ${chip('Año', esc(d.anio||''))}
        ${chip('Instrumento', esc(d.instrumento_financiacion))}
      </div>
      <div style="margin-top:.8rem; display:flex; gap:.5rem; flex-wrap:wrap">
        ${hasFicha ? `<a class=\"btn btn-primary\" href=\"${fichaHref}\">Ficha</a>` : `<span class=\"btn btn-outline\" style=\"pointer-events:none;opacity:.6\">Ficha próximamente</span>`}
        ${url ? `<a class=\"btn btn-outline\" href=\"${url}\" target=\"_blank\" rel=\"noopener\">Más información</a>` : ''}
      </div>
    </article>`;
  }

  async function main(){
    try{
      const res = await fetch(CARPETA_JSON, {cache:'no-store'});
      if(!res.ok) throw new Error('No se pudo cargar el JSON');
      const data = await res.json();

      const sUb = document.getElementById('f-ubicacion');
      const sAn = document.getElementById('f-anio');
      const sInst = document.getElementById('f-inst');
      const cards = document.getElementById('cards');
      const btnReset = document.getElementById('btn-reset');

      // Poblar selects
      uniq(data.map(d=>d.ubicacion)).forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v; sUb.appendChild(o); });
      uniq(data.map(d=>d.anio)).filter(Boolean).forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v; sAn.appendChild(o); });

      function render(){
        const fu = sUb.value, fa = sAn.value, fi = sInst.value;
        const items = data.filter(d=>{
          if(fu && d.ubicacion!==fu) return false;
          if(fa && String(d.anio)!==String(fa)) return false;
          if(fi && d.instrumento_financiacion!==fi) return false;
          return true;
        });
        cards.innerHTML = items.map(card).join('') || '<p class="muted">No hay proyectos que coincidan con el filtro.</p>';
      }

      [sUb,sAn,sInst].forEach(el=>el.addEventListener('change', render));
      btnReset.addEventListener('click', ()=>{ sUb.value=''; sAn.value=''; sInst.value=''; render(); });

      render();
    }catch(e){
      document.getElementById('cards').innerHTML = `<p class="muted">No se pudo cargar <code>${CARPETA_JSON}</code>. Verifica que existe en el repositorio y vuelve a intentarlo.</p>`;
      console.error(e);
    }
  }

  main();
})();
</script>
</body>
</html>
